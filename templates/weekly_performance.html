<!-- templates/weekly_performance.html -->
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Weekly Performance Report</title>
  <style>
    /* Minimal CSS - structure handled by tables */
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
      background-color: #0a1929;
    }

    .positive { color: #00FF88 !important; }
    .negative { color: #FF4444 !important; }
    .neutral { color: #ffffff; }
    .muted { color: #B0B0B0; }
    .accent { color: #00D9FF; }

    .monospace {
      font-family: 'JetBrains Mono', 'Courier New', monospace;
    }
  </style>
</head>
<body>
  <!-- Main Container Table -->
  <table width="100%" cellpadding="0" cellspacing="0" border="0" style="background: #0a1929;">
    <tr>
      <td align="center" style="padding: 20px;">
        <!-- Content Table (max-width: 800px) -->
        <table width="100%" cellpadding="0" cellspacing="0" border="0" style="max-width: 800px; background: #0a1929;">

          <!-- Header -->
          <tr>
            <td style="background: linear-gradient(135deg, rgba(0, 217, 255, 0.2) 0%, rgba(0, 255, 136, 0.1) 100%); border: 1px solid rgba(0, 217, 255, 0.3); border-radius: 12px; padding: 30px; text-align: center; margin-bottom: 20px;">
              <div style="display: inline-flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                <img src="https://raw.githubusercontent.com/Samie-mirghani/insider-cluster-watch/main/docs/assets/icons/logo.png" width="24" height="24" alt="â—†" style="vertical-align: middle;" />
                <span style="font-size: 20px; font-weight: 700; letter-spacing: 0.5px; color: #ffffff;">INSIDER CLUSTER <span style="color: #94a3b8;">WATCH</span></span>
              </div>
              <h1 style="margin: 0; font-size: 28px; font-weight: 700; color: #ffffff;">Weekly Performance Report</h1>
              <p style="margin: 10px 0 0 0; color: #B0B0B0; font-size: 14px;">{{ date }}</p>
            </td>
          </tr>

          <!-- Spacer -->
          <tr><td style="height: 20px;"></td></tr>

          <!-- Summary Card -->
          <tr>
            <td style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(0, 217, 255, 0.2); border-radius: 12px; padding: 20px;">
              <p style="font-size: 15px; color: #B0B0B0; line-height: 1.6; margin: 0 0 20px 0;">
                {% if total_signals_1m > 0 %}
                Your Insider Cluster Watch system has tracked <strong style="color: #00D9FF;">{{ total_signals_1m }} signal{{ 's' if total_signals_1m != 1 else '' }}</strong>
                over the past month. Here's your comprehensive performance analysis:
                {% else %}
                Your Insider Cluster Watch system is actively monitoring. Not enough historical data yet for a full performance report.
                Keep accumulating signals!
                {% endif %}
              </p>

              {% if total_signals_1m > 0 %}
              <!-- Primary Stats Grid (2x2) -->
              <table width="100%" cellpadding="0" cellspacing="0" border="0">
                <tr>
                  <!-- Total Signals -->
                  <td width="48%" style="padding: 5px;">
                    <table width="100%" cellpadding="20" cellspacing="0" border="0" style="background: rgba(0, 217, 255, 0.1); border: 1px solid rgba(0, 217, 255, 0.4); border-radius: 12px; text-align: center;">
                      <tr>
                        <td>
                          <div style="font-size: 11px; color: #B0B0B0; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600;">TOTAL SIGNALS</div>
                          <div style="font-size: 32px; font-weight: 700; color: #00D9FF;">{{ total_signals_1m }}</div>
                          <div style="font-size: 12px; color: #B0B0B0; margin-top: 5px;">tracked this period</div>
                        </td>
                      </tr>
                    </table>
                  </td>
                  <td width="4%"></td>
                  <!-- Hit Rate -->
                  <td width="48%" style="padding: 5px;">
                    <table width="100%" cellpadding="20" cellspacing="0" border="0" style="background: rgba(0, 255, 136, 0.1); border: 1px solid rgba(0, 255, 136, 0.4); border-radius: 12px; text-align: center;">
                      <tr>
                        <td>
                          <div style="font-size: 11px; color: #B0B0B0; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600;">HIT RATE</div>
                          <div style="font-size: 32px; font-weight: 700; color: #00FF88;">{{ hit_rate_1m }}%</div>
                          <div style="font-size: 12px; color: #B0B0B0; margin-top: 5px;">{{ winners_1m }} of {{ total_signals_1m }} profitable</div>
                        </td>
                      </tr>
                    </table>
                  </td>
                </tr>
                <tr><td colspan="3" style="height: 15px;"></td></tr>
                <tr>
                  <!-- Avg Return -->
                  <td width="48%" style="padding: 5px;">
                    <table width="100%" cellpadding="20" cellspacing="0" border="0" style="background: rgba(56, 189, 248, 0.1); border: 1px solid rgba(56, 189, 248, 0.4); border-radius: 12px; text-align: center;">
                      <tr>
                        <td>
                          <div style="font-size: 11px; color: #B0B0B0; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600;">AVG RETURN</div>
                          <div style="font-size: 32px; font-weight: 700; color: #00D9FF;">{{ avg_return_1m }}%</div>
                          <div style="font-size: 12px; color: #B0B0B0; margin-top: 5px;">per signal (1-month)</div>
                        </td>
                      </tr>
                    </table>
                  </td>
                  <td width="4%"></td>
                  <!-- Avg Alpha -->
                  <td width="48%" style="padding: 5px;">
                    <table width="100%" cellpadding="20" cellspacing="0" border="0" style="background: rgba(251, 191, 36, 0.1); border: 1px solid rgba(251, 191, 36, 0.4); border-radius: 12px; text-align: center;">
                      <tr>
                        <td>
                          <div style="font-size: 11px; color: #B0B0B0; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600;">AVG ALPHA</div>
                          <div style="font-size: 32px; font-weight: 700; color: #fbbf24;">{{ avg_alpha_1m }}%</div>
                          <div style="font-size: 12px; color: #B0B0B0; margin-top: 5px;">vs SPY benchmark</div>
                        </td>
                      </tr>
                    </table>
                  </td>
                </tr>
              </table>
              {% endif %}
            </td>
          </tr>

          {% if total_signals_1m > 0 %}
          <!-- Spacer -->
          <tr><td style="height: 20px;"></td></tr>

          <!-- Enhanced Metrics Card -->
          <tr>
            <td style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(0, 217, 255, 0.2); border-radius: 12px; padding: 20px;">
              <h3 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 700; color: #00D9FF;">{{ icons.trending|safe }} Advanced Risk Metrics</h3>

              <!-- First Row: 3 columns -->
              <table width="100%" cellpadding="0" cellspacing="0" border="0">
                <tr>
                  <td width="32%" style="padding: 5px;">
                    <table width="100%" cellpadding="15" cellspacing="0" border="0" style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; text-align: center;">
                      <tr>
                        <td>
                          <div style="font-size: 10px; color: #B0B0B0; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; font-weight: 600;">SHARPE RATIO</div>
                          <div style="font-size: 22px; font-weight: 700; color: {% if sharpe_ratio_1m|float >= 1 %}#00FF88{% elif sharpe_ratio_1m|float < 0 %}#FF4444{% else %}#00D9FF{% endif %};">{{ sharpe_ratio_1m }}</div>
                        </td>
                      </tr>
                    </table>
                  </td>
                  <td width="2%"></td>
                  <td width="32%" style="padding: 5px;">
                    <table width="100%" cellpadding="15" cellspacing="0" border="0" style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; text-align: center;">
                      <tr>
                        <td>
                          <div style="font-size: 10px; color: #B0B0B0; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; font-weight: 600;">MAX DRAWDOWN</div>
                          <div style="font-size: 22px; font-weight: 700; color: #FF4444;">{{ max_drawdown_1m }}%</div>
                        </td>
                      </tr>
                    </table>
                  </td>
                  <td width="2%"></td>
                  <td width="32%" style="padding: 5px;">
                    <table width="100%" cellpadding="15" cellspacing="0" border="0" style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; text-align: center;">
                      <tr>
                        <td>
                          <div style="font-size: 10px; color: #B0B0B0; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; font-weight: 600;">WIN/LOSS RATIO</div>
                          <div style="font-size: 22px; font-weight: 700; color: {% if win_loss_ratio_1m|float >= 1.5 %}#00FF88{% else %}#00D9FF{% endif %};">{{ win_loss_ratio_1m }}</div>
                        </td>
                      </tr>
                    </table>
                  </td>
                </tr>
              </table>

              <div style="height: 15px;"></div>

              <!-- Second Row: 3 columns -->
              <table width="100%" cellpadding="0" cellspacing="0" border="0">
                <tr>
                  <td width="32%" style="padding: 5px;">
                    <table width="100%" cellpadding="15" cellspacing="0" border="0" style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; text-align: center;">
                      <tr>
                        <td>
                          <div style="font-size: 10px; color: #B0B0B0; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; font-weight: 600;">MEDIAN RETURN</div>
                          <div style="font-size: 22px; font-weight: 700; color: {% if median_return_1m|float > 0 %}#00FF88{% elif median_return_1m|float < 0 %}#FF4444{% else %}#00D9FF{% endif %};">{{ median_return_1m }}%</div>
                        </td>
                      </tr>
                    </table>
                  </td>
                  <td width="2%"></td>
                  <td width="32%" style="padding: 5px;">
                    <table width="100%" cellpadding="15" cellspacing="0" border="0" style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; text-align: center;">
                      <tr>
                        <td>
                          <div style="font-size: 10px; color: #B0B0B0; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; font-weight: 600;">BEST TRADE</div>
                          <div style="font-size: 22px; font-weight: 700; color: #00FF88;">+{{ best_return_1m }}%</div>
                        </td>
                      </tr>
                    </table>
                  </td>
                  <td width="2%"></td>
                  <td width="32%" style="padding: 5px;">
                    <table width="100%" cellpadding="15" cellspacing="0" border="0" style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; text-align: center;">
                      <tr>
                        <td>
                          <div style="font-size: 10px; color: #B0B0B0; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; font-weight: 600;">WORST TRADE</div>
                          <div style="font-size: 22px; font-weight: 700; color: #FF4444;">{{ worst_return_1m }}%</div>
                        </td>
                      </tr>
                    </table>
                  </td>
                </tr>
              </table>
            </td>
          </tr>

          <!-- Paper Trading Section -->
          {% if paper_trading.enabled %}
          <!-- Spacer -->
          <tr><td style="height: 20px;"></td></tr>

          <tr>
            <td style="background: rgba(251, 191, 36, 0.05); border: 1px solid rgba(251, 191, 36, 0.3); border-radius: 12px; padding: 24px;">
              <h3 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 700; color: #fbbf24;">{{ icons.dollar|safe }} Paper Trading Performance</h3>

              <!-- Health Status Badge -->
              <table width="100%" cellpadding="0" cellspacing="0" border="0" style="margin-bottom: 20px;">
                <tr>
                  <td align="center">
                    {% if paper_trading.health_status == 'HEALTHY' %}
                    <span style="display: inline-block; padding: 8px 20px; border-radius: 20px; font-size: 13px; font-weight: 600; background: rgba(0, 255, 136, 0.15); color: #00FF88; border: 1px solid rgba(0, 255, 136, 0.3);">
                      {{ icons.check|safe }} Portfolio Health: HEALTHY
                    </span>
                    {% elif paper_trading.health_status == 'WARNING' %}
                    <span style="display: inline-block; padding: 8px 20px; border-radius: 20px; font-size: 13px; font-weight: 600; background: rgba(251, 191, 36, 0.15); color: #fbbf24; border: 1px solid rgba(251, 191, 36, 0.3);">
                      {{ icons.warning|safe }} Portfolio Health: WARNING ({{ paper_trading.health_alerts }} alert{{ 's' if paper_trading.health_alerts != 1 else '' }})
                    </span>
                    {% elif paper_trading.health_status == 'CRITICAL' %}
                    <span style="display: inline-block; padding: 8px 20px; border-radius: 20px; font-size: 13px; font-weight: 600; background: rgba(255, 68, 68, 0.15); color: #FF4444; border: 1px solid rgba(255, 68, 68, 0.3);">
                      {{ icons.critical|safe }} Portfolio Health: CRITICAL ({{ paper_trading.health_alerts }} alert{{ 's' if paper_trading.health_alerts != 1 else '' }})
                    </span>
                    {% endif %}
                  </td>
                </tr>
              </table>

              <!-- Paper Trading Metrics Grid (2 columns x 6 rows = 12 metrics) -->
              <table width="100%" cellpadding="0" cellspacing="0" border="0">
                <tr>
                  <td width="48%" style="padding: 6px;">
                    <table width="100%" cellpadding="15" cellspacing="0" border="0" style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; text-align: center;">
                      <tr>
                        <td>
                          <div style="font-size: 10px; color: #B0B0B0; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; font-weight: 600;">PORTFOLIO VALUE</div>
                          <div style="font-size: 20px; font-weight: 700; color: #00D9FF;">${{ "{:,.2f}".format(paper_trading.portfolio_value) }}</div>
                        </td>
                      </tr>
                    </table>
                  </td>
                  <td width="4%"></td>
                  <td width="48%" style="padding: 6px;">
                    <table width="100%" cellpadding="15" cellspacing="0" border="0" style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; text-align: center;">
                      <tr>
                        <td>
                          <div style="font-size: 10px; color: #B0B0B0; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; font-weight: 600;">TOTAL RETURN</div>
                          <div style="font-size: 20px; font-weight: 700; color: {% if paper_trading.total_return >= 0 %}#00FF88{% else %}#FF4444{% endif %};">{{ "{:+.2f}".format(paper_trading.total_return) }}%</div>
                        </td>
                      </tr>
                    </table>
                  </td>
                </tr>
                <tr>
                  <td width="48%" style="padding: 6px;">
                    <table width="100%" cellpadding="15" cellspacing="0" border="0" style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; text-align: center;">
                      <tr>
                        <td>
                          <div style="font-size: 10px; color: #B0B0B0; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; font-weight: 600;">CASH AVAILABLE</div>
                          <div style="font-size: 20px; font-weight: 700; color: #ffffff;">${{ "{:,.2f}".format(paper_trading.cash) }}</div>
                        </td>
                      </tr>
                    </table>
                  </td>
                  <td width="4%"></td>
                  <td width="48%" style="padding: 6px;">
                    <table width="100%" cellpadding="15" cellspacing="0" border="0" style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; text-align: center;">
                      <tr>
                        <td>
                          <div style="font-size: 10px; color: #B0B0B0; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; font-weight: 600;">EXPOSURE</div>
                          <div style="font-size: 20px; font-weight: 700; color: #ffffff;">{{ "{:.1f}".format(paper_trading.exposure_pct) }}%</div>
                        </td>
                      </tr>
                    </table>
                  </td>
                </tr>
                <tr>
                  <td width="48%" style="padding: 6px;">
                    <table width="100%" cellpadding="15" cellspacing="0" border="0" style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; text-align: center;">
                      <tr>
                        <td>
                          <div style="font-size: 10px; color: #B0B0B0; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; font-weight: 600;">WIN RATE</div>
                          <div style="font-size: 20px; font-weight: 700; color: {% if paper_trading.hit_rate >= 55 %}#00FF88{% elif paper_trading.hit_rate >= 45 %}#fbbf24{% else %}#FF4444{% endif %};">{{ "{:.1f}".format(paper_trading.hit_rate) }}%</div>
                        </td>
                      </tr>
                    </table>
                  </td>
                  <td width="4%"></td>
                  <td width="48%" style="padding: 6px;">
                    <table width="100%" cellpadding="15" cellspacing="0" border="0" style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; text-align: center;">
                      <tr>
                        <td>
                          <div style="font-size: 10px; color: #B0B0B0; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; font-weight: 600;">TOTAL TRADES</div>
                          <div style="font-size: 20px; font-weight: 700; color: #ffffff;">{{ paper_trading.total_trades }}</div>
                        </td>
                      </tr>
                    </table>
                  </td>
                </tr>
                <tr>
                  <td width="48%" style="padding: 6px;">
                    <table width="100%" cellpadding="15" cellspacing="0" border="0" style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; text-align: center;">
                      <tr>
                        <td>
                          <div style="font-size: 10px; color: #B0B0B0; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; font-weight: 600;">OPEN POSITIONS</div>
                          <div style="font-size: 20px; font-weight: 700; color: #ffffff;">{{ paper_trading.open_positions }}</div>
                        </td>
                      </tr>
                    </table>
                  </td>
                  <td width="4%"></td>
                  <td width="48%" style="padding: 6px;">
                    <table width="100%" cellpadding="15" cellspacing="0" border="0" style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; text-align: center;">
                      <tr>
                        <td>
                          <div style="font-size: 10px; color: #B0B0B0; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; font-weight: 600;">PENDING ENTRIES</div>
                          <div style="font-size: 20px; font-weight: 700; color: #ffffff;">{{ paper_trading.pending_entries }}</div>
                        </td>
                      </tr>
                    </table>
                  </td>
                </tr>
                <tr>
                  <td width="48%" style="padding: 6px;">
                    <table width="100%" cellpadding="15" cellspacing="0" border="0" style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; text-align: center;">
                      <tr>
                        <td>
                          <div style="font-size: 10px; color: #B0B0B0; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; font-weight: 600;">REALIZED P&L</div>
                          <div style="font-size: 20px; font-weight: 700; color: {% if paper_trading.realized_pnl >= 0 %}#00FF88{% else %}#FF4444{% endif %};">${{ "{:,.2f}".format(paper_trading.realized_pnl) }}</div>
                        </td>
                      </tr>
                    </table>
                  </td>
                  <td width="4%"></td>
                  <td width="48%" style="padding: 6px;">
                    <table width="100%" cellpadding="15" cellspacing="0" border="0" style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; text-align: center;">
                      <tr>
                        <td>
                          <div style="font-size: 10px; color: #B0B0B0; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; font-weight: 600;">MAX DRAWDOWN</div>
                          <div style="font-size: 20px; font-weight: 700; color: {% if paper_trading.max_drawdown > -10 %}#00FF88{% elif paper_trading.max_drawdown > -20 %}#fbbf24{% else %}#FF4444{% endif %};">{{ "{:.2f}".format(paper_trading.max_drawdown) }}%</div>
                        </td>
                      </tr>
                    </table>
                  </td>
                </tr>
                <tr>
                  <td width="48%" style="padding: 6px;">
                    <table width="100%" cellpadding="15" cellspacing="0" border="0" style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; text-align: center;">
                      <tr>
                        <td>
                          <div style="font-size: 10px; color: #B0B0B0; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; font-weight: 600;">AVG WIN</div>
                          <div style="font-size: 20px; font-weight: 700; color: #00FF88;">${{ "{:.2f}".format(paper_trading.avg_win) }}</div>
                          <div style="font-size: 11px; color: #B0B0B0;">({{ "{:+.2f}".format(paper_trading.avg_win_pct) }}%)</div>
                        </td>
                      </tr>
                    </table>
                  </td>
                  <td width="4%"></td>
                  <td width="48%" style="padding: 6px;">
                    <table width="100%" cellpadding="15" cellspacing="0" border="0" style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; text-align: center;">
                      <tr>
                        <td>
                          <div style="font-size: 10px; color: #B0B0B0; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; font-weight: 600;">AVG LOSS</div>
                          <div style="font-size: 20px; font-weight: 700; color: #FF4444;">${{ "{:.2f}".format(paper_trading.avg_loss) }}</div>
                          <div style="font-size: 11px; color: #B0B0B0;">({{ "{:+.2f}".format(paper_trading.avg_loss_pct) }}%)</div>
                        </td>
                      </tr>
                    </table>
                  </td>
                </tr>
              </table>

              <!-- Additional Stats Row (3 columns) -->
              <div style="height: 15px;"></div>
              <table width="100%" cellpadding="15" cellspacing="0" border="0" style="background: rgba(255, 255, 255, 0.03); border-radius: 8px;">
                <tr>
                  <td width="33%" align="center">
                    <div style="font-size: 10px; color: #B0B0B0; text-transform: uppercase; margin-bottom: 5px;">WINNERS</div>
                    <div style="font-size: 18px; font-weight: 700; color: #00FF88;">{{ paper_trading.winning_trades }}</div>
                  </td>
                  <td width="33%" align="center">
                    <div style="font-size: 10px; color: #B0B0B0; text-transform: uppercase; margin-bottom: 5px;">LOSERS</div>
                    <div style="font-size: 18px; font-weight: 700; color: #FF4444;">{{ paper_trading.losing_trades }}</div>
                  </td>
                  <td width="33%" align="center">
                    <div style="font-size: 10px; color: #B0B0B0; text-transform: uppercase; margin-bottom: 5px;">AVG HOLD TIME</div>
                    <div style="font-size: 18px; font-weight: 700; color: #fbbf24;">{{ "{:.1f}".format(paper_trading.avg_hold_days) }} days</div>
                  </td>
                </tr>
              </table>

              <!-- Feature Highlights -->
              <div style="height: 15px;"></div>
              <table width="100%" cellpadding="12" cellspacing="0" border="0" style="background: rgba(255, 255, 255, 0.03); border-left: 3px solid #fbbf24; border-radius: 8px;">
                <tr>
                  <td>
                    <div style="font-size: 11px; color: #fbbf24; font-weight: 600; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;">{{ icons.zap|safe }} ACTIVE FEATURES</div>
                    <div style="font-size: 12px; color: #B0B0B0; line-height: 1.6;">
                      {{ icons.check|safe }} Trailing Stop Loss (auto-adjusting after +3% gain)<br>
                      {{ icons.check|safe }} Score-Weighted Position Sizing (5-15% per position, 60% max total exposure)<br>
                      {{ icons.check|safe }} Partial Position Scaling (2-tranche entries on -2% pullback)<br>
                      {{ icons.check|safe }} Health Monitoring (daily risk checks)
                    </div>
                  </td>
                </tr>
              </table>
            </td>
          </tr>
          {% endif %}

          <!-- Sector Analysis Card -->
          {% if sector_analysis %}
          <!-- Spacer -->
          <tr><td style="height: 20px;"></td></tr>

          <tr>
            <td style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(0, 217, 255, 0.2); border-radius: 12px; padding: 20px;">
              <h3 style="margin: 0 0 15px 0; font-size: 18px; font-weight: 700; color: #00D9FF;">{{ icons.building|safe }} Performance by Sector</h3>
              <table width="100%" cellpadding="0" cellspacing="0" border="0" style="border-collapse: collapse; margin-top: 15px;">
                <thead>
                  <tr>
                    <th style="color: #00D9FF; text-align: left; padding: 12px; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 1px solid rgba(0, 217, 255, 0.3); font-weight: 600;">Sector</th>
                    <th style="color: #00D9FF; text-align: left; padding: 12px; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 1px solid rgba(0, 217, 255, 0.3); font-weight: 600;">Signals</th>
                    <th style="color: #00D9FF; text-align: left; padding: 12px; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 1px solid rgba(0, 217, 255, 0.3); font-weight: 600;">Hit Rate</th>
                    <th style="color: #00D9FF; text-align: left; padding: 12px; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 1px solid rgba(0, 217, 255, 0.3); font-weight: 600;">Avg Return</th>
                  </tr>
                </thead>
                <tbody>
                  {% for sector in sector_analysis[:5] %}
                  <tr style="{% if loop.index is even %}background: rgba(255, 255, 255, 0.02);{% endif %}">
                    <td style="padding: 12px; border-bottom: 1px solid rgba(255, 255, 255, 0.05); color: #ffffff;"><strong>{{ sector.sector }}</strong></td>
                    <td style="padding: 12px; border-bottom: 1px solid rgba(255, 255, 255, 0.05); color: #ffffff;">{{ sector.count }}</td>
                    <td style="padding: 12px; border-bottom: 1px solid rgba(255, 255, 255, 0.05); color: #ffffff;">
                      <span style="display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 600; {% if sector.hit_rate >= 65 %}background: rgba(0, 255, 136, 0.15); color: #00FF88;{% elif sector.hit_rate >= 55 %}background: rgba(0, 217, 255, 0.15); color: #00D9FF;{% elif sector.hit_rate >= 45 %}background: rgba(251, 191, 36, 0.15); color: #fbbf24;{% else %}background: rgba(255, 68, 68, 0.15); color: #FF4444;{% endif %}">
                        {{ sector.hit_rate }}%
                      </span>
                    </td>
                    <td style="padding: 12px; border-bottom: 1px solid rgba(255, 255, 255, 0.05);">
                      <strong style="{% if sector.avg_return > 0 %}color: #00FF88;{% else %}color: #FF4444;{% endif %}">
                        {{ "{:+.2f}".format(sector.avg_return) }}%
                      </strong>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </td>
          </tr>
          {% endif %}

          <!-- Pattern Analysis Card -->
          {% if pattern_analysis %}
          <!-- Spacer -->
          <tr><td style="height: 20px;"></td></tr>

          <tr>
            <td style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(0, 217, 255, 0.2); border-radius: 12px; padding: 20px;">
              <h3 style="margin: 0 0 15px 0; font-size: 18px; font-weight: 700; color: #00D9FF;">{{ icons.search|safe }} Performance by Pattern</h3>
              <table width="100%" cellpadding="0" cellspacing="0" border="0" style="border-collapse: collapse; margin-top: 15px;">
                <thead>
                  <tr>
                    <th style="color: #00D9FF; text-align: left; padding: 12px; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 1px solid rgba(0, 217, 255, 0.3); font-weight: 600;">Pattern</th>
                    <th style="color: #00D9FF; text-align: left; padding: 12px; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 1px solid rgba(0, 217, 255, 0.3); font-weight: 600;">Count</th>
                    <th style="color: #00D9FF; text-align: left; padding: 12px; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 1px solid rgba(0, 217, 255, 0.3); font-weight: 600;">Hit Rate</th>
                    <th style="color: #00D9FF; text-align: left; padding: 12px; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 1px solid rgba(0, 217, 255, 0.3); font-weight: 600;">Avg Return</th>
                  </tr>
                </thead>
                <tbody>
                  {% for pattern in pattern_analysis %}
                  <tr style="{% if loop.index is even %}background: rgba(255, 255, 255, 0.02);{% endif %}">
                    <td style="padding: 12px; border-bottom: 1px solid rgba(255, 255, 255, 0.05); color: #ffffff;"><strong>{{ pattern.pattern }}</strong></td>
                    <td style="padding: 12px; border-bottom: 1px solid rgba(255, 255, 255, 0.05); color: #ffffff;">{{ pattern.count }}</td>
                    <td style="padding: 12px; border-bottom: 1px solid rgba(255, 255, 255, 0.05); color: #ffffff;">
                      <span style="display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 600; {% if pattern.hit_rate >= 65 %}background: rgba(0, 255, 136, 0.15); color: #00FF88;{% elif pattern.hit_rate >= 55 %}background: rgba(0, 217, 255, 0.15); color: #00D9FF;{% elif pattern.hit_rate >= 45 %}background: rgba(251, 191, 36, 0.15); color: #fbbf24;{% else %}background: rgba(255, 68, 68, 0.15); color: #FF4444;{% endif %}">
                        {{ pattern.hit_rate }}%
                      </span>
                    </td>
                    <td style="padding: 12px; border-bottom: 1px solid rgba(255, 255, 255, 0.05);">
                      <strong style="{% if pattern.avg_return > 0 %}color: #00FF88;{% else %}color: #FF4444;{% endif %}">
                        {{ "{:+.2f}".format(pattern.avg_return) }}%
                      </strong>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </td>
          </tr>
          {% endif %}

          <!-- Top Performers Card -->
          {% if top_performers %}
          <!-- Spacer -->
          <tr><td style="height: 20px;"></td></tr>

          <tr>
            <td style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(0, 217, 255, 0.2); border-radius: 12px; padding: 20px;">
              <h3 style="margin: 0 0 15px 0; font-size: 18px; font-weight: 700; color: #00D9FF;">{{ icons.trophy|safe }} Top 3 Performers (1-Month)</h3>
              {% for signal in top_performers %}
              <table width="100%" cellpadding="15" cellspacing="0" border="0" style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; margin-bottom: 10px;">
                <tr>
                  <td width="60%" style="vertical-align: top;">
                    <div style="font-size: 18px; font-weight: 700; color: #00D9FF; font-family: 'JetBrains Mono', 'Courier New', monospace; margin-bottom: 3px;">{{ signal.ticker }}</div>
                    <div style="font-size: 12px; color: #B0B0B0;">Signal: {{ signal.signal_date }} | Score: {{ signal.signal_score }}</div>
                  </td>
                  <td width="40%" align="right" style="vertical-align: top;">
                    <div style="font-size: 24px; font-weight: 700; color: #00FF88;">{{ signal.return_pct }}%</div>
                    <div style="font-size: 11px; color: #B0B0B0;">Alpha: {{ signal.alpha_pct }}%</div>
                  </td>
                </tr>
              </table>
              {% endfor %}
            </td>
          </tr>
          {% endif %}

          <!-- Worst Performers Card -->
          {% if worst_performers %}
          <!-- Spacer -->
          <tr><td style="height: 20px;"></td></tr>

          <tr>
            <td style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(0, 217, 255, 0.2); border-radius: 12px; padding: 20px;">
              <h3 style="margin: 0 0 15px 0; font-size: 18px; font-weight: 700; color: #00D9FF;">{{ icons.down|safe }} Worst 3 Performers (Learn from These)</h3>
              {% for signal in worst_performers %}
              <table width="100%" cellpadding="15" cellspacing="0" border="0" style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; margin-bottom: 10px;">
                <tr>
                  <td width="60%" style="vertical-align: top;">
                    <div style="font-size: 18px; font-weight: 700; color: #00D9FF; font-family: 'JetBrains Mono', 'Courier New', monospace; margin-bottom: 3px;">{{ signal.ticker }}</div>
                    <div style="font-size: 12px; color: #B0B0B0;">Signal: {{ signal.signal_date }}</div>
                  </td>
                  <td width="40%" align="right" style="vertical-align: top;">
                    <div style="font-size: 24px; font-weight: 700; color: #FF4444;">{{ signal.return_pct }}%</div>
                    <div style="font-size: 11px; color: #B0B0B0;">Alpha: {{ signal.alpha_pct }}%</div>
                  </td>
                </tr>
              </table>
              {% endfor %}
            </td>
          </tr>
          {% endif %}

          <!-- Performance Assessment Card -->
          {% set assessment_class = 'excellent' if (sharpe_ratio_1m|float >= 1.0 and avg_alpha_1m|float > 0 and hit_rate_1m|float >= 55) else ('good' if (sharpe_ratio_1m|float >= 0.5 and avg_alpha_1m|float > 0) else ('warning' if avg_alpha_1m|float > 0 else 'danger')) %}

          <!-- Spacer -->
          <tr><td style="height: 20px;"></td></tr>

          <tr>
            <td style="background: {% if assessment_class == 'excellent' %}rgba(0, 255, 136, 0.05){% elif assessment_class == 'good' %}rgba(0, 217, 255, 0.05){% elif assessment_class == 'warning' %}rgba(251, 191, 36, 0.05){% else %}rgba(255, 68, 68, 0.05){% endif %}; border-left: 4px solid {% if assessment_class == 'excellent' %}#00FF88{% elif assessment_class == 'good' %}#00D9FF{% elif assessment_class == 'warning' %}#fbbf24{% else %}#FF4444{% endif %}; padding: 20px; border-radius: 8px;">
              <h3 style="margin: 0 0 15px 0; font-size: 18px; font-weight: 700; color: {% if assessment_class == 'excellent' %}#00FF88{% elif assessment_class == 'good' %}#00D9FF{% elif assessment_class == 'warning' %}#fbbf24{% else %}#FF4444{% endif %};">{{ icons.inbox|safe }} Strategy Assessment</h3>
              <ul style="margin: 0; padding-left: 20px; color: #B0B0B0; line-height: 1.8;">
                {% if sharpe_ratio_1m|float >= 1.0 %}
                <li style="margin: 8px 0;"><strong>{{ icons.check|safe }} Excellent risk-adjusted returns</strong> - Sharpe ratio of {{ sharpe_ratio_1m }} indicates strong performance relative to volatility</li>
                {% elif sharpe_ratio_1m|float >= 0.5 %}
                <li style="margin: 8px 0;"><strong>{{ icons.check|safe }} Good risk-adjusted returns</strong> - Sharpe ratio of {{ sharpe_ratio_1m }} shows positive risk/reward</li>
                {% elif sharpe_ratio_1m|float >= 0 %}
                <li style="margin: 8px 0;"><strong>{{ icons.warning|safe }} Moderate risk-adjusted returns</strong> - Sharpe ratio of {{ sharpe_ratio_1m }} could be improved</li>
                {% else %}
                <li style="margin: 8px 0;"><strong>{{ icons.warning|safe }} Poor risk-adjusted returns</strong> - Negative Sharpe ratio indicates losses or excessive volatility</li>
                {% endif %}

                {% if avg_alpha_1m|float > 0 %}
                <li style="margin: 8px 0;">Your signals are <strong style="color: #00FF88;">outperforming SPY</strong> by an average of <strong>{{ avg_alpha_1m }}%</strong></li>
                {% else %}
                <li style="margin: 8px 0;">Your signals are <strong style="color: #FF4444;">underperforming SPY</strong> by <strong>{{ avg_alpha_1m }}%</strong> - strategy needs review</li>
                {% endif %}

                {% if hit_rate_1m|float >= 55 %}
                <li style="margin: 8px 0;">Hit rate of <strong>{{ hit_rate_1m }}%</strong> exceeds the 55% target {{ icons.check|safe }}</li>
                {% else %}
                <li style="margin: 8px 0;">Hit rate of <strong>{{ hit_rate_1m }}%</strong> is below the 55% target {{ icons.warning|safe }}</li>
                {% endif %}

                {% if win_loss_ratio_1m|float >= 1.5 %}
                <li style="margin: 8px 0;"><strong>{{ icons.check|safe }} Strong win/loss ratio</strong> of {{ win_loss_ratio_1m }} - winners are significantly larger than losers</li>
                {% elif win_loss_ratio_1m|float >= 1.0 %}
                <li style="margin: 8px 0;"><strong>Moderate win/loss ratio</strong> of {{ win_loss_ratio_1m }} - average win slightly larger than average loss</li>
                {% else %}
                <li style="margin: 8px 0;"><strong>{{ icons.warning|safe }} Poor win/loss ratio</strong> of {{ win_loss_ratio_1m }} - losses are larger than wins on average</li>
                {% endif %}

                {% if max_drawdown_1m|float > -10 %}
                <li style="margin: 8px 0;"><strong>{{ icons.check|safe }} Low drawdown</strong> of {{ max_drawdown_1m }}% indicates good risk management</li>
                {% elif max_drawdown_1m|float > -20 %}
                <li style="margin: 8px 0;"><strong>Moderate drawdown</strong> of {{ max_drawdown_1m }}% - acceptable but monitor closely</li>
                {% else %}
                <li style="margin: 8px 0;"><strong>{{ icons.warning|safe }} High drawdown</strong> of {{ max_drawdown_1m }}% - consider tighter stop losses</li>
                {% endif %}

                {% if total_signals_1w > 0 %}
                <li style="margin: 8px 0;">1-week performance: <strong>{{ hit_rate_1w }}%</strong> hit rate, <strong>{{ avg_alpha_1w }}%</strong> alpha, Sharpe: <strong>{{ sharpe_ratio_1w }}</strong></li>
                {% endif %}

                {% if sharpe_ratio_1m|float >= 1.0 and avg_alpha_1m|float > 1 and hit_rate_1m|float >= 55 %}
                <li style="margin: 8px 0;"><strong style="color: #00FF88;">{{ icons.target|safe }} STRATEGY IS WORKING EXCELLENTLY</strong> - Continue with current approach</li>
                {% elif avg_alpha_1m|float > 0 and hit_rate_1m|float >= 50 %}
                <li style="margin: 8px 0;"><strong style="color: #00D9FF;">Strategy is working</strong> - Minor optimization may help</li>
                {% elif total_signals_1m < 10 %}
                <li style="margin: 8px 0;">Need more data points for statistical significance - keep monitoring {{ icons.chart|safe }}</li>
                {% else %}
                <li style="margin: 8px 0;"><strong style="color: #FF4444;">{{ icons.warning|safe }} Strategy needs review</strong> - Consider adjusting signal criteria or position sizing</li>
                {% endif %}
              </ul>
            </td>
          </tr>

          {% else %}
          <!-- Not Enough Data Card -->
          <!-- Spacer -->
          <tr><td style="height: 20px;"></td></tr>

          <tr>
            <td style="background: rgba(255, 255, 255, 0.03); border-left: 4px solid #00D9FF; padding: 20px; border-radius: 8px;">
              <h3 style="margin: 0 0 15px 0; font-size: 18px; font-weight: 700; color: #00D9FF;">{{ icons.chart|safe }} Building Your Track Record</h3>
              <ul style="margin: 0; padding-left: 20px; color: #B0B0B0; line-height: 1.8;">
                <li style="margin: 8px 0;">Your system is actively monitoring insider filings daily</li>
                <li style="margin: 8px 0;">Performance tracking begins after signals accumulate</li>
                <li style="margin: 8px 0;">Target: 10+ signals for meaningful statistics</li>
                <li style="margin: 8px 0;">Weekly reports will show full metrics once data is available</li>
                <li style="margin: 8px 0;">New features active: Sector analysis, quality filters, pattern detection, news sentiment</li>
              </ul>
            </td>
          </tr>
          {% endif %}

          <!-- Charts Note -->
          <!-- Spacer -->
          <tr><td style="height: 20px;"></td></tr>

          <tr>
            <td style="background: rgba(0, 217, 255, 0.05); border-left: 4px solid #00D9FF; padding: 15px; border-radius: 8px;">
              <p style="margin: 0; font-size: 13px; color: #B0B0B0;">
                {{ icons.chart|safe }} <strong>Detailed Charts Available:</strong> View rolling hit rate, cumulative alpha, and sector performance visualizations
                in your GitHub repository at <code style="background: rgba(255, 255, 255, 0.1); padding: 2px 6px; border-radius: 4px; font-family: 'JetBrains Mono', 'Courier New', monospace; font-size: 12px; color: #00D9FF;">data/plots/</code> or run <code style="background: rgba(255, 255, 255, 0.1); padding: 2px 6px; border-radius: 4px; font-family: 'JetBrains Mono', 'Courier New', monospace; font-size: 12px; color: #00D9FF;">python jobs/visualize.py</code> locally.
              </p>
            </td>
          </tr>

          <!-- Footer -->
          <!-- Spacer -->
          <tr><td style="height: 20px;"></td></tr>

          <tr>
            <td style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 20px; text-align: center; color: #B0B0B0; font-size: 12px;">
              <p style="margin: 5px 0;"><strong style="color: #00D9FF;">Insider Cluster Watch - Enhanced Performance Tracking</strong></p>
              <p style="margin: 5px 0;">Performance tracking powered by real-time backtest analysis with advanced risk metrics</p>
              <p style="margin: 10px 0 5px 0;"><em>This report is for informational purposes only. Past performance does not guarantee future results.</em></p>
            </td>
          </tr>

        </table>
      </td>
    </tr>
  </table>
</body>
</html>
