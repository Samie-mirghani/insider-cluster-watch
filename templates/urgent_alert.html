<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body style="margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif; background-color: #fff5f5;">
  
  <!-- Main Container - Full Width -->
  <table width="100%" cellpadding="0" cellspacing="0" border="0" style="background: white; border: 3px solid #dc2626;">
    
    <!-- Header -->
    <tr>
      <td style="background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%); padding: 40px 30px; text-align: center; color: white;">
        <table width="100%" cellpadding="0" cellspacing="0" border="0">
          <tr>
            <td align="center">
              <div style="background: #fef2f2; color: #dc2626; display: inline-block; padding: 10px 24px; border-radius: 25px; font-size: 13px; font-weight: 700; text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 20px;">
                üö® URGENT ALERT
              </div>
            </td>
          </tr>
          <tr>
            <td align="center" style="padding-top: 10px;">
              <h1 style="margin: 0; font-size: 28px; font-weight: 700; color: white;">High-Conviction Insider Buying</h1>
            </td>
          </tr>
          <tr>
            <td align="center" style="padding-top: 12px;">
              <p style="margin: 0; font-size: 15px; opacity: 0.95; color: white;">{{ date }}</p>
            </td>
          </tr>
        </table>
      </td>
    </tr>
    
    <!-- Alert Notice -->
    <tr>
      <td style="padding: 25px;">
        <table width="100%" cellpadding="0" cellspacing="0" border="0" style="background: #fef2f2; border: 2px solid #dc2626; border-radius: 8px;">
          <tr>
            <td style="padding: 25px; text-align: center;">
              <h2 style="margin: 0 0 12px 0; color: #dc2626; font-size: 20px; font-weight: 700;">‚ö° Immediate Attention Required</h2>
              <p style="margin: 0; color: #991b1b; font-size: 15px; font-weight: 500;">{{ urgent_trades|length }} high-conviction insider buying cluster{{ 's' if urgent_trades|length != 1 else '' }} detected</p>
            </td>
          </tr>
        </table>
      </td>
    </tr>
    
    <!-- Content -->
    <tr>
      <td style="padding: 0 30px 35px 30px;">
        {% for item in urgent_trades %}
        <!-- Signal Card -->
        <table width="100%" cellpadding="0" cellspacing="0" border="0" style="background: linear-gradient(135deg, #fef2f2 0%, #fff 100%); border: 3px solid #dc2626; border-radius: 10px;">
          <tr>
            <td style="padding: 30px;">
              
              <!-- Signal Header -->
              <table width="100%" cellpadding="0" cellspacing="0" border="0" style="border-bottom: 3px solid #fee2e2; padding-bottom: 20px; margin-bottom: 25px;">
                <tr>
                  <td align="left" valign="middle" width="60%">
                    <h2 style="margin: 0; font-size: 36px; font-weight: 900; color: #dc2626; letter-spacing: 2px;">{{ item.ticker }}</h2>
                  </td>
                  <td align="right" valign="middle" width="40%">
                    <span style="background: #dc2626; color: white; padding: 12px 24px; border-radius: 25px; font-size: 13px; font-weight: 700; text-transform: uppercase; white-space: nowrap; display: inline-block;">‚ö° URGENT</span>
                  </td>
                </tr>
              </table>

              <!-- Multi-Signal Badges -->
              <table width="100%" cellpadding="0" cellspacing="0" border="0" style="margin: 15px 0;">
                <tr>
                  <td>
                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                      {% if item.multi_signal_tier and item.multi_signal_tier == 'tier1' %}
                      <span style="background: #dc2626; color: white; padding: 6px 16px; border-radius: 12px; font-size: 13px; font-weight: 700; display: inline-block;" title="Three or more confirming signals detected: Insider + Politician + 13F Holdings">üî• TIER 1 (3+ SIGNALS)</span>
                      {% elif item.multi_signal_tier and item.multi_signal_tier == 'tier2' %}
                      <span style="background: #f59e0b; color: white; padding: 6px 16px; border-radius: 12px; font-size: 13px; font-weight: 700; display: inline-block;" title="Two confirming signals detected: Insider Buying + Politician Trading OR Insider Buying + 13F Holdings">‚ö° TIER 2 (2 SIGNALS)</span>
                      {% endif %}

                      {% if item.has_politician_signal %}
                      <span style="background: #8b5cf6; color: white; padding: 6px 16px; border-radius: 12px; font-size: 13px; font-weight: 700; display: inline-block;" title="Confirmed by recent politician trading activity">üèõÔ∏è POLITICIAN ACTIVITY</span>
                      {% endif %}
                    </div>
                  </td>
                </tr>
              </table>

              <!-- Multi-Signal Details Section -->
              {% if item.multi_signal_tier and item.multi_signal_tier in ['tier1', 'tier2'] %}
              <table width="100%" cellpadding="0" cellspacing="0" border="0" style="background: #fef3c7; border: 3px solid #f59e0b; border-radius: 8px; margin: 20px 0;">
                <tr>
                  <td style="padding: 20px;">
                    <div style="font-size: 13px; color: #92400e; font-weight: 700; text-transform: uppercase; margin-bottom: 12px;">
                      {% if item.multi_signal_tier == 'tier1' %}
                      üî• TIER 1 MULTI-SIGNAL CONFIRMATION
                      {% else %}
                      ‚ö° TIER 2 MULTI-SIGNAL CONFIRMATION
                      {% endif %}
                    </div>
                    {% if item.multi_signal_explanation %}
                    <div style="color: #92400e; font-size: 15px; margin-bottom: 15px; font-weight: 600;">
                      <strong>Signal Combination:</strong> {{ item.multi_signal_explanation }}
                    </div>
                    {% endif %}

                    <!-- Politician Details -->
                    {% if item.politician_details and item.politician_details|length > 0 %}
                    <div style="margin-top: 15px;">
                      <div style="font-size: 12px; color: #92400e; font-weight: 700; text-transform: uppercase; margin-bottom: 8px;">
                        üèõÔ∏è POLITICIAN TRADING ({{ item.politician_count }} politician{{ 's' if item.politician_count != 1 else '' }}):
                      </div>
                      <div style="color: #92400e; font-size: 14px; line-height: 1.8; font-weight: 500;">
                        {% for detail in item.politician_details %}
                        ‚Ä¢ {{ detail }}<br>
                        {% endfor %}
                      </div>
                    </div>
                    {% endif %}

                    <!-- Institutional Details -->
                    {% if item.institutional_details and item.institutional_details|length > 0 %}
                    <div style="margin-top: 15px;">
                      <div style="font-size: 12px; color: #92400e; font-weight: 700; text-transform: uppercase; margin-bottom: 8px;">
                        üè¶ INSTITUTIONAL HOLDERS - 13F ({{ item.institutional_count }} priority fund{{ 's' if item.institutional_count != 1 else '' }}):
                      </div>
                      <div style="color: #92400e; font-size: 14px; line-height: 1.8; font-weight: 500;">
                        {% for detail in item.institutional_details %}
                        ‚Ä¢ {{ detail }}<br>
                        {% endfor %}
                        {% if item.institutional_count > 10 %}
                        <em style="font-size: 12px;">...and {{ item.institutional_count - 10 }} more priority institutions</em>
                        {% endif %}
                      </div>
                    </div>
                    {% endif %}
                  </td>
                </tr>
              </table>
              {% endif %}
              
              <!-- Key Metrics -->
              <table width="100%" cellpadding="0" cellspacing="0" border="0" style="background: white; border: 2px solid #fee2e2; border-radius: 8px; margin: 25px 0;">
                <tr>
                  <td style="padding: 25px;">
                    <table width="100%" cellpadding="0" cellspacing="0" border="0">
                      <!-- First Row -->
                      <tr>
                        <td width="50%" style="padding: 10px;">
                          <table width="100%" cellpadding="15" cellspacing="0" border="0" style="background: linear-gradient(135deg, #fef2f2 0%, #fff 100%); border-radius: 8px; border: 1px solid #fee2e2;">
                            <tr>
                              <td align="center">
                                <div style="font-size: 11px; color: #991b1b; text-transform: uppercase; font-weight: 700; margin-bottom: 10px;">INSIDER CLUSTER</div>
                                <div style="font-size: 28px; font-weight: 700; color: #dc2626; margin-bottom: 5px;">{{ item.cluster_count }}</div>
                                <div style="font-size: 14px; color: #991b1b; font-weight: 600;">buyers</div>
                              </td>
                            </tr>
                          </table>
                        </td>
                        <td width="50%" style="padding: 10px;">
              <table width="100%" cellpadding="15" cellspacing="0" border="0" style="background: linear-gradient(135deg, #fef2f2 0%, #fff 100%); border-radius: 8px; border: 1px solid #fee2e2;">
                <tr>
                  <td align="center">
                    <div style="font-size: 11px; color: #991b1b; text-transform: uppercase; font-weight: 700; margin-bottom: 10px;">TOTAL VALUE</div>
                    <div style="font-size: 28px; font-weight: 700; color: #dc2626; margin-bottom: 5px;">
                      {% if item.total_value >= 1000000 %}
                        ${{ "{:.1f}".format(item.total_value/1000000) }}M
                      {% elif item.total_value >= 1000 %}
                        ${{ "{:.1f}".format(item.total_value/1000) }}K
                      {% else %}
                        ${{ "{:,.0f}".format(item.total_value) }}
                      {% endif %}
                    </div>
                    <div style="font-size: 14px; color: #991b1b; font-weight: 600;">purchased</div>
                  </td>
                </tr>
              </table>
            </td>
                      </tr>
                      <!-- Second Row -->
                      <tr>
                        <td width="50%" style="padding: 10px;">
                          <table width="100%" cellpadding="15" cellspacing="0" border="0" style="background: linear-gradient(135deg, #fef2f2 0%, #fff 100%); border-radius: 8px; border: 1px solid #fee2e2;">
                            <tr>
                              <td align="center">
                                <div style="font-size: 11px; color: #991b1b; text-transform: uppercase; font-weight: 700; margin-bottom: 10px;">CONVICTION SCORE</div>
                                <div style="font-size: 28px; font-weight: 700; color: #dc2626; margin-bottom: 5px;">{{ item.avg_conviction|round(1) }}</div>
                                <div style="font-size: 14px; color: #991b1b; font-weight: 600;">/ 20</div>
                              </td>
                            </tr>
                          </table>
                        </td>
                        <td width="50%" style="padding: 10px;">
                          <table width="100%" cellpadding="15" cellspacing="0" border="0" style="background: linear-gradient(135deg, #fef2f2 0%, #fff 100%); border-radius: 8px; border: 1px solid #fee2e2;">
                            <tr>
                              <td align="center">
                                <div style="font-size: 11px; color: #991b1b; text-transform: uppercase; font-weight: 700; margin-bottom: 10px;">RANK SCORE</div>
                                <div style="font-size: 28px; font-weight: 700; color: #dc2626; margin-bottom: 5px;">{{ item.rank_score|round(1) }}</div>
                                <div style="font-size: 14px; color: #991b1b; font-weight: 600;">high</div>
                              </td>
                            </tr>
                          </table>
                        </td>
                      </tr>
                    </table>
                  </td>
                </tr>
              </table>
              
              <!-- Insiders Highlight -->
              <table width="100%" cellpadding="0" cellspacing="0" border="0" style="background: white; border: 2px solid #fbbf24; border-radius: 8px; margin: 20px 0;">
                <tr>
                  <td style="padding: 20px;">
                    <div style="font-size: 12px; color: #92400e; font-weight: 700; text-transform: uppercase; margin-bottom: 10px;">üë• INSIDERS BUYING ({{ item.cluster_count }} TOTAL)</div>
                    <div style="color: #78350f; font-size: 15px; font-weight: 600; line-height: 1.6;">{{ item.insiders }}</div>
                  </td>
                </tr>
              </table>
              
              <!-- Price Highlight -->
              <table width="100%" cellpadding="0" cellspacing="0" border="0" style="background: white; border: 2px solid #fee2e2; border-radius: 8px; margin: 20px 0;">
                <tr>
                  <td style="padding: 20px 15px;">
                    <table width="100%" cellpadding="0" cellspacing="0" border="0">
                      <tr>
                        <td width="33%" align="center" style="padding: 5px;">
                          <div style="font-size: 28px; margin-bottom: 8px;">üí∞</div>
                          <div style="font-size: 11px; color: #991b1b; text-transform: uppercase; font-weight: 600; margin-bottom: 8px;">CURRENT PRICE</div>
                          <div style="font-size: 22px; font-weight: 700; color: #dc2626;">${{ item.currentPrice|round(2) if item.currentPrice else 'N/A' }}</div>
                        </td>
                        <td width="33%" align="center" style="padding: 5px;">
                          <div style="font-size: 28px; margin-bottom: 8px;">üìä</div>
                          <div style="font-size: 11px; color: #991b1b; text-transform: uppercase; font-weight: 600; margin-bottom: 8px;">FROM 52W LOW</div>
                          <div style="font-size: 22px; font-weight: 700; color: #dc2626;">+{{ item.pct_from_52wk_low|round(1) if item.pct_from_52wk_low else 'N/A' }}%</div>
                        </td>
                        <td width="33%" align="center" style="padding: 5px;">
                          <div style="font-size: 28px; margin-bottom: 8px;">üìÖ</div>
                          <div style="font-size: 11px; color: #991b1b; text-transform: uppercase; font-weight: 600; margin-bottom: 8px;">LAST TRADE</div>
                          <div style="font-size: 22px; font-weight: 700; color: #dc2626;">{{ item.last_trade_date.strftime('%b %d') if item.last_trade_date else 'Recent' }}</div>
                        </td>
                      </tr>
                    </table>
                  </td>
                </tr>
              </table>
              
              <!-- Action Urgent -->
              <table width="100%" cellpadding="0" cellspacing="0" border="0" style="background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%); border-radius: 8px; margin: 25px 0;">
                <tr>
                  <td style="padding: 25px; text-align: center; color: white;">
                    <div style="font-size: 12px; font-weight: 700; text-transform: uppercase; margin-bottom: 12px; opacity: 0.95;">‚ö° RECOMMENDED ACTION</div>
                    <div style="font-size: 18px; font-weight: 700; line-height: 1.5;">{{ item.suggested_action }}</div>
                  </td>
                </tr>
              </table>
              
              <!-- Rationale Box -->
              <table width="100%" cellpadding="0" cellspacing="0" border="0" style="background: #f8f9fa; border-left: 4px solid #dc2626; border-radius: 5px; margin: 20px 0;">
                <tr>
                  <td style="padding: 20px;">
                    <div style="font-size: 12px; color: #666; font-weight: 700; text-transform: uppercase; margin-bottom: 10px;">üìã SIGNAL RATIONALE</div>
                    <div style="color: #333; font-size: 14px; line-height: 1.7;">{{ item.rationale }}</div>
                  </td>
                </tr>
              </table>
              
              <!-- Warning Box -->
              <table width="100%" cellpadding="0" cellspacing="0" border="0" style="background: #fffbeb; border: 2px solid #f59e0b; border-radius: 8px; margin: 25px 0;">
                <tr>
                  <td style="padding: 20px;">
                    <p style="color: #92400e; font-size: 13px; line-height: 1.7; margin: 0;">
                      <strong>‚ö†Ô∏è Risk Reminder:</strong> Always conduct your own research before trading. 
                      Use proper position sizing (2-5% of portfolio) and set stop losses immediately after entry. 
                      Past insider buying does not guarantee future returns.
                    </p>
                  </td>
                </tr>
              </table>

            </td>
          </tr>
        </table>

        {% if not loop.last %}
        <!-- Spacer between signals -->
        <div style="margin-bottom: 25px;"></div>
        {% endif %}
        {% endfor %}
      </td>
    </tr>

    <!-- Footer -->
    <tr>
      <td style="background: #f8f9fa; padding: 25px; text-align: center; border-top: 1px solid #e0e0e0;">
        <p style="margin: 8px 0; color: #333; font-size: 12px; font-weight: 600;">‚ö° Insider Cluster Watch - Urgent Alert System</p>
        <p style="margin: 8px 0; color: #666; font-size: 12px;">Data sourced from public SEC Form 4 filings via OpenInsider & SEC EDGAR</p>
        <p style="margin: 12px 0 8px 0; color: #666; font-size: 12px;"><em>This alert is for informational purposes only and does not constitute financial advice.</em></p>
      </td>
    </tr>
  </table>

</body>
</html>
